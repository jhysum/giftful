# Project overview

Use this guide to build backend for the Giftful app, where users can track important dates and get gift suggestions for friends and family.

# Tech stack

- We will use Next.js, Supabase, Clerk

# Tables & buckets already created

Supabase storage Bucket: "contact_images"

TABLE users (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
user_id TEXT NOT NULL,
name TEXT NOT NULL,
email TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

TABLE contacts (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
name TEXT NOT NULL,
relationship_type TEXT NOT NULL,
interests TEXT,
image_url TEXT,
user_id TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

TABLE important_dates (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
contact_id BIGINT NOT NULL REFERENCES contacts(id),
event_type TEXT NOT NULL,
date DATE NOT NULL,
user_id TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

TABLE gift_suggestions (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
contact_id BIGINT NOT NULL REFERENCES contacts(id),
name TEXT NOT NULL,
description TEXT NOT NULL,
price NUMERIC NOT NULL,
is_favorite BOOLEAN DEFAULT FALSE,
user_id TEXT NOT NULL,
created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

# Requirements

1. Create user to user table
1. After a user signin via clerk, we should get the userId from clerk, and check if this userId exists in 'users' table, matching "user_id"
1. If the user doesn't exist, then create a user in 'users' table
1. If the user exists already, then proceed, and pass on user_id to functions

1. Contact management
1. When user adds a contact, store contact details in "contacts" table
1. If user uploads a contact image, upload the image file to supabase "contact_images" storage bucket
1. Add the image url to the "contacts" data table as "image_url", and creator_user_id to be the actual user_id

1. Important dates handling
1. Store important dates in the "important_dates" table
1. Enable querying dates by proximity (next 30 days)
1. Include contact reference for easy joins

1. Gift suggestions workflow
1. When user requests gift suggestions, call Claude API with contact relationship and interests
1. Parse response and store suggestions in "gift_suggestions" table
1. Associate suggestions with specific contacts through contact_id

1. Favorites interaction
1. When user marks a gift suggestion as favorite, update is_favorite to TRUE in 'gift_suggestions' table
1. When user un-marks a favorite, update is_favorite to FALSE

# Documentations

## Example of uploading files to supabase storage

```javascript
import { createClient } from '@supabase/supabase-js'

// Create Supabase client
const supabase = createClient('your_project_url', 'your_supabase_api_key')

// Upload file using standard upload
async function uploadFile(file) {
 const { data, error } = await supabase.storage.from('contact_images').upload('file_path', file)
 if (error) {
   // Handle error
 } else {
   // Handle success
   return data.path
 }
}
Example of Claude API integration
javascriptCopyimport Anthropic from '@anthropic-ai/sdk';

const anthropic = new Anthropic({
  apiKey: process.env.ANTHROPIC_API_KEY,
});

async function getGiftSuggestions(relationship, interests) {
  const response = await anthropic.messages.create({
    model: 'claude-3-haiku-20240307',
    max_tokens: 1000,
    system: 'You are a helpful gift suggestion assistant.',
    messages: [
      {
        role: 'user',
        content: `Suggest 3 gift ideas for a ${relationship} who enjoys ${interests}.`
      }
    ]
  });

  return parseGiftSuggestions(response.content[0].text);
}
Notification system setup
javascriptCopy// Function to find upcoming events
async function findUpcomingEvents() {
  const today = new Date();
  const nextWeek = new Date();
  nextWeek.setDate(today.getDate() + 7);

  const { data, error } = await supabase
    .from('important_dates')
    .select('*, contacts(name)')
    .gte('date', today.toISOString().split('T')[0])
    .lte('date', nextWeek.toISOString().split('T')[0]);

  return data;
}
```
